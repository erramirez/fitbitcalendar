define(["domReady","v"],function(e,t){var n=Backbone.View.extend({render:function(){function l(e){var n=new Date(e.getFullYear(),e.getMonth()+1,0),r=+t.day(e),i=+t.week(e),s=+t.day(n),o=+t.week(n);return"M"+(i+1)*t.cellSize+","+r*t.cellSize+"H"+i*t.cellSize+"V"+7*t.cellSize+"H"+o*t.cellSize+"V"+(s+1)*t.cellSize+"H"+(o+1)*t.cellSize+"V"+0+"H"+(i+1)*t.cellSize+"Z"}var n=this,r={t:2,b:2,l:35,r:2},i=t.cellSize*53,s=t.cellSize*7,o=d3.select(this.el).attr({width:i+r.l+r.r,height:s+r.t+r.b}),u=o.append("g").attr({transform:"translate("+r.l+","+r.t+")"}).datum(this.model);u.append("text").attr({transform:"translate("+ -(t.cellSize*1)+","+t.cellSize*3.5+")rotate(-90)"}).style({dy:".35em","text-anchor":"middle","font-size":"19px"}).text(function(e,t){return e.get("year")});var a=u.selectAll(".day").data(function(e,t){return e.get("data")}).enter().append("rect").attr({"class":"day",width:t.cellSize,height:t.cellSize,x:function(e){return t.week(e.date)*t.cellSize},y:function(e){return t.day(e.date)*t.cellSize}}).style("fill",function(e){return t.color(e.steps)});a.on("mouseover",function(e){n.trigger("tooltip",!0,this,{steps:e.steps,text:e.date.format("{dd}/{MM}/{yy}"),week:t.week(e.date)}),u.append("rect").attr({"class":"dayHover",width:t.cellSize,height:t.cellSize,x:t.week(e.date)*t.cellSize,y:t.day(e.date)*t.cellSize})}),a.on("mouseout",function(e){u.selectAll(".dayHover").remove(),n.trigger("tooltip",!1)});var f=d3.time.months(new Date(+this.model.get("year"),0,1),new Date(+this.model.get("year")+1,0,1));u.selectAll(".month").data(f).enter().append("path").attr("class","month").attr("d",l),u.selectAll(".month3").data(f).enter().insert("path",":first-child").attr("class","month3").attr("d",l)}});return n});