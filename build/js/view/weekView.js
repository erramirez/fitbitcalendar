define(["domReady","v"],function(e,t){function r(){function c(e){var n=t.week(e.values.date)*t.cellSize,r=t.week(e.values.date.clone().endOfMonth())*t.cellSize;return(r-n)/2+n}function h(e){return"M"+(e.get("week").first().key*t.cellSize+t.cellSize*.05)+","+i+"h"+(e.get("week").last().key*t.cellSize-e.get("week").first().key*t.cellSize+t.cellSize-t.cellSize*.05)}var e=this,n={t:0,b:30,l:35,r:2},r=t.cellSize*53,i=t.barSize,s=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],o=d3.scale.linear().range([i,0]).domain([0,this.collection.max]),u=d3.scale.ordinal().rangeBands([0,r],0).domain(d3.range(12)),a=d3.select(this.el),f=a.attr({width:r+n.l+n.r,height:i+n.t+n.b}).append("g").attr({transform:"translate("+n.l+","+n.t+")"}),l=f.selectAll(".bars").data(this.model.get("week")).enter().append("rect").attr({"class":"bars",x:function(e){return e.key*t.cellSize+.1*t.cellSize},width:function(e){return t.cellSize-.2*t.cellSize},y:i,height:0}).style("fill",function(e){return t.color(e.value)});l.on("mouseover",function(r){e.trigger("tooltip",!0,this,{steps:r.value,text:"average",week:r.key}),d3.select(this).attr("class","linkColor").style("fill","");var i=d3.select(this.parentNode.parentNode.parentNode.parentNode).select(".calendarView g"),s={"class":"dayHover",width:t.cellSize,height:t.cellSize*7,x:r.key*t.cellSize,y:0};i.append("rect").attr(s).style({fill:"gray",stroke:"none","stroke-width":4,"pointer-events":"none",opacity:.8}),i.append("rect").attr(s).style({fill:"none",stroke:"none","stroke-width":2,"pointer-events":"none"})}),l.on("mouseout",function(n){f.selectAll(".dayHover").remove(),d3.select(this).attr("class","").style("fill",function(e){return t.color(e.value)}),e.trigger("tooltip",!1)}),l.transition().delay(function(e){return e.key*5}).attr({y:function(e){return o(e.value)},height:function(e){return i-o(e.value)}}),f.selectAll(".months").data(this.model.get("month")).enter().append("text").attr({x:c,y:i+n.b/2,fill:function(e){return"black"},dy:".50em"}).text(function(e){return s[+e.key]})}var n=Backbone.View.extend({render:r});return n});